<?phperror_reporting(E_ALL ^ E_NOTICE ^ E_WARNING);include 'includes/database.php';require 'vendor/autoload.php'; // PhpSpreadsheet autoloaderuse PhpOffice\PhpSpreadsheet\Spreadsheet;use PhpOffice\PhpSpreadsheet\Writer\Xlsx;use PhpOffice\PhpSpreadsheet\Style\Fill;$get_date = (isset($_REQUEST['get_date']) && $_REQUEST['get_date'] != '') ? trim($_REQUEST['get_date']) : date('Y-m-d');	$u_query = "SELECT  c.*, d.dbd_amt, d.doc_value				FROM happi_bajaj_ta_transactions a 				JOIN happi_bajaj_do_transactions b ON(b.app_cas_id = a.txn_id) 				JOIN happi_bajaj_apx_transactions c ON(c.apr_no = b.do_id AND c.upload_date = a.upload_date) 				JOIN happi_dbd_master_data d ON(d.invoice_no = c.invoice_no) 				where a.trans_date = '$get_date' 				ORDER BY c.id ASC"; //echo $u_query;exit;	//echo $u_query;exit;$u_res = mysqli_query($conn, $u_query);$u_count = mysqli_num_rows($u_res);$spreadsheet = new Spreadsheet();$sheet = $spreadsheet->getActiveSheet();// Set headers$headers = array(    'Credit Card',    'Voucher No.',    'Card No.',    'Apr. No.',    'Invoice No.',    'Amount',    'Date');$sheet->fromArray($headers, NULL, 'A1');$rowIndex = 2;if ($u_count > 0) {   $seen_apr_no = [];  // store processed apr_no	while ($row = mysqli_fetch_assoc($u_res)) {		$apr_no = $row['apr_no'];		// skip if this apr_no was already seen		if (isset($seen_apr_no[$apr_no])) {			continue;		}		// mark this apr_no as seen		$seen_apr_no[$apr_no] = true;		$stdate1 = explode('-', $row['trn_date']);		$trn_date = $stdate1[2] . '-' . $stdate1[1] . '-' . $stdate1[0];		$lineData = array(			"BAJAJ FINANCE",			$row['voucher_no'],			"'" . $row['card_no'],			"'" . $row['apr_no'],			$row['invoice_no'],			$row['amount'],			$trn_date		);		$sheet->fromArray($lineData, NULL, 'A' . $rowIndex);		$rowIndex++;	}}// Output as Excel$filename = 'Apx-Bajaj-Matched-BULK-' . $get_date . '.xlsx';header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');header("Content-Disposition: attachment;filename=\"$filename\"");header('Cache-Control: max-age=0');$writer = new Xlsx($spreadsheet);$writer->save('php://output');exit;